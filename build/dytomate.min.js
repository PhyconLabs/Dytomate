/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
  * Reqwest! A general purpose XHR connection manager
  * license MIT (c) Dustin Diaz 2014
  * https://github.com/ded/reqwest
  */

/**
 * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>
 * Build: `lodash modularize modern exports="amd" -o ./modern/`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */

(function(){var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("bower/almond/almond",function(){}),!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define("reqwest",n):t[e]=n()}("reqwest",this,function(){function succeed(e){return httpsRe.test(window.location.protocol)?twoHundo.test(e.status):!!e.response}function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,succeed(e.request)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var i=typeof FormData=="function"&&t.data instanceof FormData;!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),!n[contentType]&&!i&&(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n["type"]=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n["type"]=="jsonp"?handleJsonp(n,e,t,i):(o=n.xhr&&n.xhr(n)||xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),win[xDomainRequest]&&o instanceof win[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(e.match("json"))return"json";if(e.match("javascript"))return"js";if(e.match("text"))return"html";if(e.match("xml"))return"xml"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var win=window,doc=document,httpsRe=/^http/,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("lodash-amd/modern/internals/isNative",[],function(){function r(e){return typeof e=="function"&&n.test(e)}var e=Object.prototype,t=e.toString,n=RegExp("^"+String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return r}),define("lodash-amd/modern/internals/objectTypes",[],function(){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1};return e}),define("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(e){function t(t){return!!t&&!!e[typeof t]}return t}),define("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(e){var t=Object.prototype,n=t.hasOwnProperty,r=function(t){var r,i=t,s=[];if(!i)return s;if(!e[typeof t])return s;for(r in i)n.call(i,r)&&s.push(r);return s};return r}),define("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(e,t,n){var r=e(r=Object.keys)&&r,i=r?function(e){return t(e)?r(e):[]}:n;return i}),define("lodash-amd/modern/objects/defaults",["./keys","../internals/objectTypes"],function(e,t){var n=function(n,r,i){var s,o=n,u=o;if(!o)return u;var a=arguments,f=0,l=typeof i=="number"?2:a.length;while(++f<l){o=a[f];if(o&&t[typeof o]){var c=-1,h=t[typeof o]&&e(o),p=h?h.length:0;while(++c<p)s=h[c],typeof u[s]=="undefined"&&(u[s]=o[s])}}return u};return n}),define("lodash-amd/modern/objects/isArguments",[],function(){function r(t){return t&&typeof t=="object"&&typeof t.length=="number"&&n.call(t)==e||!1}var e="[object Arguments]",t=Object.prototype,n=t.toString;return r}),define("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(e){var t="[object Array]",n=Object.prototype,r=n.toString,i=e(i=Array.isArray)&&i,s=i||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&r.call(e)==t||!1};return s}),define("lodash-amd/modern/internals/baseFlatten",["../objects/isArguments","../objects/isArray"],function(e,t){function n(r,i,s,o){var u=(o||0)-1,a=r?r.length:0,f=[];while(++u<a){var l=r[u];if(l&&typeof l=="object"&&typeof l.length=="number"&&(t(l)||e(l))){i||(l=n(l,i,s));var c=-1,h=l.length,p=f.length;f.length+=h;while(++c<h)f[p++]=l[c]}else s||f.push(l)}return f}return n}),define("lodash-amd/modern/utilities/noop",[],function(){function e(){}return e}),define("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(e,t,n){function i(e,n){return t(e)?r(e):{}}var r=e(r=Object.create)&&r;return r||(i=function(){function e(){}return function(n){if(t(n)){e.prototype=n;var r=new e;e.prototype=null}return r||window.Object()}}()),i}),define("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(e,t){var n={configurable:!1,enumerable:!1,value:null,writable:!1},r=function(){try{var t={},n=e(n=Object.defineProperty)&&n,r=n(t,t,t)&&n}catch(i){}return r}(),i=r?function(e,t){n.value=t,r(e,"__bindData__",n)}:t;return i}),define("lodash-amd/modern/internals/slice",[],function(){function e(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}return e}),define("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function o(i){function f(){if(u){var n=r(u);s.apply(n,arguments)}if(this instanceof f){var i=e(o.prototype),l=o.apply(i,n||arguments);return t(l)?l:i}return o.apply(a,n||arguments)}var o=i[0],u=i[2],a=i[4];return n(f,i),f}var i=[],s=i.push;return o}),define("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function o(i){function y(){var n=p?c:this;if(f){var i=r(f);s.apply(i,arguments)}if(l||v){i||(i=r(arguments)),l&&s.apply(i,l);if(v&&i.length<h)return a|=16,o([u,m?a:a&-4,i,null,c,h])}i||(i=arguments),d&&(u=n[g]);if(this instanceof y){n=e(u.prototype);var b=u.apply(n,i);return t(b)?b:n}return u.apply(n,i)}var u=i[0],a=i[1],f=i[2],l=i[3],c=i[4],h=i[5],p=a&1,d=a&2,v=a&4,m=a&8,g=u;return n(y,i),y}var i=[],s=i.push;return o}),define("lodash-amd/modern/objects/isFunction",[],function(){function e(e){return typeof e=="function"}return e}),define("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(e,t,n,r){function u(i,a,f,l,c,h){var p=a&1,d=a&2,v=a&4,m=a&8,g=a&16,y=a&32;if(!d&&!n(i))throw new TypeError;g&&!f.length&&(a&=-17,g=f=!1),y&&!l.length&&(a&=-33,y=l=!1);var b=i&&i.__bindData__;if(b&&b!==!0)return b=r(b),b[2]&&(b[2]=r(b[2])),b[3]&&(b[3]=r(b[3])),p&&!(b[1]&1)&&(b[4]=c),!p&&b[1]&1&&(a|=8),v&&!(b[1]&4)&&(b[5]=h),g&&s.apply(b[2]||(b[2]=[]),f),y&&o.apply(b[3]||(b[3]=[]),l),b[1]|=a,u.apply(null,b);var w=a==1||a===17?e:t;return w([i,a,f,l,c,h])}var i=[],s=i.push,o=i.unshift;return u}),define("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(e,t){function n(n,r){return arguments.length>2?e(n,17,t(arguments,2),null,r):e(n,1,null,null,r)}return n}),define("lodash-amd/modern/utilities/identity",[],function(){function e(e){return e}return e}),define("lodash-amd/modern/support",["./internals/isNative"],function(e){var t=/\bthis\b/,n={};return n.funcDecomp=!e(window.WinRTError)&&t.test(function(){return this}),n.funcNames=typeof Function.name=="string",n}),define("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(e,t,n,r){function u(u,a,f){if(typeof u!="function")return t;if(typeof a!="undefined"&&"prototype"in u){var l=u.__bindData__;if(typeof l=="undefined"){r.funcNames&&(l=!u.name),l=l||!r.funcDecomp;if(!l){var c=o.call(u);r.funcNames||(l=!i.test(c)),l||(l=s.test(c),n(u,l))}}if(l===!1||l!==!0&&l[1]&1)return u;switch(f){case 1:return function(e){return u.call(a,e)};case 2:return function(e,t){return u.call(a,e,t)};case 3:return function(e,t,n){return u.call(a,e,t,n)};case 4:return function(e,t,n,r){return u.call(a,e,t,n,r)}}return e(u,a)}return u}var i=/^\s*function[ \n\r\t]+\w/,s=/\bthis\b/,o=Function.prototype.toString;return u}),define("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(e,t){var n=function(n,r,i){var s,o=n,u=o;if(!o)return u;if(!t[typeof o])return u;r=r&&typeof i=="undefined"?r:e(r,i,3);for(s in o)if(r(o[s],s,n)===!1)return u;return u};return n}),define("lodash-amd/modern/internals/arrayPool",[],function(){var e=[];return e}),define("lodash-amd/modern/internals/getArray",["./arrayPool"],function(e){function t(){return e.pop()||[]}return t}),define("lodash-amd/modern/internals/maxPoolSize",[],function(){var e=40;return e}),define("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(e,t){function n(n){n.length=0,e.length<t&&e.push(n)}return n}),define("lodash-amd/modern/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(e,t,n,r,i){function m(p,g,y,b,w,E){if(y){var S=y(p,g);if(typeof S!="undefined")return!!S}if(p===g)return p!==0||1/p==1/g;var x=typeof p,T=typeof g;if(p===p&&(!p||!r[x])&&(!g||!r[T]))return!1;if(p==null||g==null)return p===g;var N=d.call(p),C=d.call(g);N==s&&(N=l),C==s&&(C=l);if(N!=C)return!1;switch(N){case u:case a:return+p==+g;case f:return p!=+p?g!=+g:p==0?1/p==1/g:p==+g;case c:case h:return p==String(g)}var k=N==o;if(!k){var L=v.call(p,"__wrapped__"),A=v.call(g,"__wrapped__");if(L||A)return m(L?p.__wrapped__:p,A?g.__wrapped__:g,y,b,w,E);if(N!=l)return!1;var O=p.constructor,M=g.constructor;if(O!=M&&!(n(O)&&O instanceof O&&n(M)&&M instanceof M)&&"constructor"in p&&"constructor"in g)return!1}var _=!w;w||(w=t()),E||(E=t());var D=w.length;while(D--)if(w[D]==p)return E[D]==g;var P=0;S=!0,w.push(p),E.push(g);if(k){D=p.length,P=g.length,S=P==D;if(S||b)while(P--){var H=D,B=g[P];if(b){while(H--)if(S=m(p[H],B,y,b,w,E))break}else if(!(S=m(p[P],B,y,b,w,E)))break}}else e(g,function(e,t,n){if(v.call(n,t))return P++,S=v.call(p,t)&&m(p[t],e,y,b,w,E)}),S&&!b&&e(p,function(e,t,n){if(v.call(n,t))return S=--P>-1});return w.pop(),E.pop(),_&&(i(w),i(E)),S}var s="[object Arguments]",o="[object Array]",u="[object Boolean]",a="[object Date]",f="[object Number]",l="[object Object]",c="[object RegExp]",h="[object String]",p=Object.prototype,d=p.toString,v=p.hasOwnProperty;return m}),define("lodash-amd/modern/utilities/property",[],function(){function e(e){return function(t){return t[e]}}return e}),define("lodash-amd/modern/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(e,t,n,r,i){function s(s,o,u){var a=typeof s;if(s==null||a=="function")return e(s,o,u);if(a!="object")return i(s);var f=r(s),l=f[0],c=s[l];return f.length==1&&c===c&&!n(c)?function(e){var t=e[l];return c===t&&(c!==0||1/c==1/t)}:function(e){var n=f.length,r=!1;while(n--)if(!(r=t(e[f[n]],s[f[n]],null,!0)))break;return r}}return s}),define("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,s){var o,u=r,a=u;if(!u)return a;if(!n[typeof u])return a;i=i&&typeof s=="undefined"?i:e(i,s,3);var f=-1,l=n[typeof u]&&t(u),c=l?l.length:0;while(++f<c){o=l[f];if(i(u[o],o,r)===!1)return a}return a};return r}),define("lodash-amd/modern/collections/map",["../functions/createCallback","../objects/forOwn"],function(e,t){function n(n,r,i){var s=-1,o=n?n.length:0;r=e(r,i,3);if(typeof o=="number"){var u=Array(o);while(++s<o)u[s]=r(n[s],s,n)}else u=[],t(n,function(e,t,n){u[++s]=r(e,t,n)});return u}return n}),define("lodash-amd/modern/arrays/flatten",["../internals/baseFlatten","../collections/map"],function(e,t){function n(n,r,i,s){return typeof r!="boolean"&&r!=null&&(s=i,i=typeof r!="function"&&s&&s[r]===n?null:r,r=!1),i!=null&&(n=t(n,i,s)),e(n,r)}return n}),define("plugins/core/commands/indent",[],function(){return function(){return function(e){var t=new e.api.Command("indent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return e.nodeName==="UL"||e.nodeName==="OL"});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.indent=t}}}),define("plugins/core/commands/insert-list",[],function(){return function(){return function(e){var t=function(t){e.api.Command.call(this,t)};t.prototype=Object.create(e.api.Command.prototype),t.prototype.constructor=t,t.prototype.execute=function(t){function n(e){if(e.length>0){var t=document.createElement(s.nodeName);e.forEach(function(e){t.appendChild(e)}),s.parentNode.insertBefore(t,s.nextElementSibling)}}if(this.queryState()){var r=new e.api.Selection,i=r.range,s=r.getContaining(function(e){return e.nodeName==="OL"||e.nodeName==="UL"}),o=r.getContaining(function(e){return e.nodeName==="LI"});e.transactionManager.run(function(){if(o){var t=(new e.api.Node(o)).nextAll();n(t),r.placeMarkers();var u=document.createElement("p");u.innerHTML=o.innerHTML,s.parentNode.insertBefore(u,s.nextElementSibling),o.parentNode.removeChild(o)}else{var a=Array.prototype.map.call(s.querySelectorAll("li"),function(e){return i.intersectsNode(e)&&e}).filter(function(e){return e}),f=a.slice(-1)[0],l=(new e.api.Node(f)).nextAll();n(l),r.placeMarkers();var c=document.createDocumentFragment();a.forEach(function(e){var t=document.createElement("p");t.innerHTML=e.innerHTML,c.appendChild(t)}),s.parentNode.insertBefore(c,s.nextElementSibling),a.forEach(function(e){e.parentNode.removeChild(e)})}s.childNodes.length===0&&s.parentNode.removeChild(s),r.selectMarkers()}.bind(this))}else e.api.Command.prototype.execute.call(this,t)},t.prototype.queryEnabled=function(){return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()},e.commands.insertOrderedList=new t("insertOrderedList"),e.commands.insertUnorderedList=new t("insertUnorderedList")}}}),define("plugins/core/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.Command("outdent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return e.nodeName==="UL"||e.nodeName==="OL"});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.outdent=t}}}),define("plugins/core/commands/redo",[],function(){return function(){return function(e){var t=new e.api.Command("redo");t.execute=function(){var t=e.undoManager.redo();typeof t!="undefined"&&e.restoreFromHistory(t)},t.queryEnabled=function(){return e.undoManager.position<e.undoManager.stack.length-1},e.commands.redo=t,e.el.addEventListener("keydown",function(e){e.shiftKey&&(e.metaKey||e.ctrlKey)&&e.keyCode===90&&(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands/subscript",[],function(){return function(){return function(e){var t=new e.api.Command("subscript");e.commands.subscript=t}}}),define("plugins/core/commands/superscript",[],function(){return function(){return function(e){var t=new e.api.Command("superscript");e.commands.superscript=t}}}),define("plugins/core/commands/undo",[],function(){return function(){return function(e){var t=new e.api.Command("undo");t.execute=function(){var t=e.undoManager.undo();typeof t!="undefined"&&e.restoreFromHistory(t)},t.queryEnabled=function(){return e.undoManager.position>1},e.commands.undo=t,e.el.addEventListener("keydown",function(e){!e.shiftKey&&(e.metaKey||e.ctrlKey)&&e.keyCode===90&&(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands",["./commands/indent","./commands/insert-list","./commands/outdent","./commands/redo","./commands/subscript","./commands/superscript","./commands/undo"],function(e,t,n,r,i,s,o){return{indent:e,insertList:t,outdent:n,redo:r,subscript:i,superscript:s,undo:o}}),define("lodash-amd/modern/internals/baseIndexOf",[],function(){function e(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i)if(e[r]===t)return r;return-1}return e}),define("lodash-amd/modern/objects/isString",[],function(){function r(t){return typeof t=="string"||t&&typeof t=="object"&&n.call(t)==e||!1}var e="[object String]",t=Object.prototype,n=t.toString;return r}),define("lodash-amd/modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(e,t,n,r){function s(s,o,u){var a=-1,f=e,l=s?s.length:0,c=!1;return u=(u<0?i(0,l+u):u)||0,n(s)?c=f(s,o,u)>-1:typeof l=="number"?c=(r(s)?s.indexOf(o,u):f(s,o,u))>-1:t(s,function(e){if(++a>=u)return!(c=e===o)}),c}var i=Math.max;return s}),define("lodash-amd/modern/objects/values",["./keys"],function(e){function t(t){var n=-1,r=e(t),i=r.length,s=Array(i);while(++n<i)s[n]=t[r[n]];return s}return t}),define("lodash-amd/modern/collections/toArray",["../objects/isString","../internals/slice","../objects/values"],function(e,t,n){function r(e){return e&&typeof e.length=="number"?t(e):n(e)}return r}),define("scribe-common/src/element",["lodash-amd/modern/collections/contains"],function(e){function n(n){return e(t,n.nodeName)}function r(e){return e.nodeType===Node.ELEMENT_NODE&&e.className==="scribe-marker"}function i(e,t){while(t.childNodes.length>0)e.insertBefore(t.childNodes[0],t);e.removeChild(t)}var t=["P","LI","DIV","BLOCKQUOTE","UL","OL","H1","H2","H3","H4","H5","H6"];return{isBlockElement:n,isSelectionMarkerNode:r,unwrap:i}}),define("scribe-common/src/node",[],function(){function e(e){return e.nodeType===Node.TEXT_NODE&&e.textContent===""}function t(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function n(e){return e.parentNode.removeChild(e)}return{isEmptyTextNode:e,insertAfter:t,removeNode:n}}),define("dom-observer",["lodash-amd/modern/arrays/flatten","lodash-amd/modern/collections/toArray","scribe-common/src/element","scribe-common/src/node"],function(e,t,n,r){function i(i,s){function o(i){var s=e(i.map(function(e){var n=t(e.addedNodes),r=t(e.removedNodes);return n.concat(r)})),o=s.filter(function(e){return!r.isEmptyTextNode(e)}).filter(function(e){return!n.isSelectionMarkerNode(e)});return o.length>0}var u=!1,a=new MutationObserver(function(e){if(!u&&o(e)){u=!0;try{s()}finally{setTimeout(function(){u=!1},0)}}});return a.observe(i,{attributes:!0,childList:!0,subtree:!0}),a}return i}),define("plugins/core/events",["lodash-amd/modern/collections/contains","../../dom-observer"],function(e,t){return function(){return function(n){var r=function(){setTimeout(function(){n.pushHistory()}.bind(n),0),n.el.removeEventListener("focus",r)}.bind(n);n.el.addEventListener("focus",r),n.el.addEventListener("focus",function(){function o(e){var t=document.createTreeWalker(e),n=t.currentNode;return t.firstChild()?t.currentNode.nodeName==="BR"?n:o(t.currentNode):t.currentNode}var t=new n.api.Selection;if(t.range){t.placeMarkers();var r=n.allowsBlockElements()&&n.getHTML().match(/^<em class="scribe-marker"><\/em>/);t.removeMarkers();if(r){var i=o(n.el.firstChild),s=t.range;s.setStart(i,0),s.setEnd(i,0),t.selection.removeAllRanges(),t.selection.addRange(s)}}}.bind(n));var i=function(){if(!n._skipFormatters){var e=new n.api.Selection,t=e.range,r=function(){t&&e.placeMarkers(),n.setHTML(n._htmlFormatterFactory.format(n.getHTML())),e.selectMarkers()}.bind(n);t?(n.undoManager.undo(),n.transactionManager.run(r)):r()}delete n._skipFormatters}.bind(n);t(n.el,i),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(e.keyCode===13){var t=new n.api.Selection,r=t.range,i=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});if(i&&r.collapsed){var s=r.cloneRange();s.setEndAfter(i,0);var o=s.cloneContents();o.firstChild.textContent===""&&(e.preventDefault(),n.transactionManager.run(function(){var e=document.createElement("p"),n=document.createElement("br");e.appendChild(n),i.parentNode.insertBefore(e,i.nextElementSibling),r.setStart(e,0),r.setEnd(e,0),t.selection.removeAllRanges(),t.selection.addRange(r)}))}}}),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(e.keyCode===13||e.keyCode===8){var t=new n.api.Selection,r=t.range;if(r.collapsed){var i=t.getContaining(function(e){return e.nodeName==="LI"});if(i&&i.textContent.trim()===""){e.preventDefault();var s=t.getContaining(function(e){return e.nodeName==="UL"||e.nodeName==="OL"}),o=n.getCommand(s.nodeName==="OL"?"insertOrderedList":"insertUnorderedList");o.execute()}}}}),n.el.addEventListener("paste",function(r){if(r.clipboardData)r.preventDefault(),e(r.clipboardData.types,"text/html")?n.insertHTML(r.clipboardData.getData("text/html")):n.insertPlainText(r.clipboardData.getData("text/plain"));else{var i=new n.api.Selection;i.placeMarkers();var s=document.createElement("div");document.body.appendChild(s),s.setAttribute("contenteditable",!0),s.focus(),setTimeout(function(){var e=s.innerHTML;s.parentNode.removeChild(s),i.selectMarkers(),n.el.focus(),n.insertHTML(e)},1)}})}}}),define("plugins/core/formatters/html/replace-nbsp-chars",[],function(){return function(){return function(e){var t=/(\s|&nbsp;)+/g;e.registerHTMLFormatter("export",function(e){return e.replace(t," ")})}}}),define("lodash-amd/modern/arrays/last",["../functions/createCallback","../internals/slice"],function(e,t){function i(i,s,o){var u=0,a=i?i.length:0;if(typeof s!="number"&&s!=null){var f=a;s=e(s,o,3);while(f--&&s(i[f],f,i))u++}else{u=s;if(u==null||o)return i?i[a-1]:n}return t(i,r(0,a-u))}var n,r=Math.max;return i}),define("plugins/core/formatters/html/enforce-p-elements",["lodash-amd/modern/arrays/last","scribe-common/src/element"],function(e,t){function n(n){var r=Array.prototype.reduce.call(n.childNodes,function(n,r){function o(){var e=[r];n.push(e)}var i=e(n);if(!i)o();else{var s=t.isBlockElement(i[0]);s===t.isBlockElement(r)?i.push(r):o()}return n},[]),i=r.filter(function(e){var n=t.isBlockElement(e[0]);return!n});i.forEach(function(e){var t=document.createElement("p");e[0].parentNode.insertBefore(t,e[0]),e.forEach(function(e){t.appendChild(e)})}),n._isWrapped=!0}function r(e){var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),i=t.firstChild();while(i){if(i.nodeName==="BLOCKQUOTE"&&!i._isWrapped){n(i),r(e);break}i=t.nextSibling()}}return function(){return function(e){e.registerHTMLFormatter("normalize",function(e){var t=document.createElement("div");return t.innerHTML=e,n(t),r(t),t.innerHTML})}}}),define("plugins/core/formatters/html/ensure-selectable-containers",["scribe-common/src/element","lodash-amd/modern/collections/contains"],function(e,t){function r(i){function o(t){return t.children.length===0||t.children.length===1&&e.isSelectionMarkerNode(t.children[0])}var s=i.firstElementChild;while(s)e.isSelectionMarkerNode(s)||(o(s)&&s.textContent.trim()===""&&!t(n,s.nodeName)?s.appendChild(document.createElement("br")):s.children.length>0&&r(s)),s=s.nextElementSibling}var n=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];return function(){return function(e){e.registerHTMLFormatter("normalize",function(e){var t=document.createElement("div");return t.innerHTML=e,r(t),t.innerHTML})}}}),define("lodash-amd/modern/internals/htmlEscapes",[],function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e}),define("lodash-amd/modern/internals/escapeHtmlChar",["./htmlEscapes"],function(e){function t(t){return e[t]}return t}),define("lodash-amd/modern/internals/reUnescapedHtml",["./htmlEscapes","../objects/keys"],function(e,t){var n=RegExp("["+t(e).join("")+"]","g");return n}),define("lodash-amd/modern/utilities/escape",["../internals/escapeHtmlChar","../objects/keys","../internals/reUnescapedHtml"],function(e,t,n){function r(t){return t==null?"":String(t).replace(n,e)}return r}),define("plugins/core/formatters/plain-text/escape-html-characters",["lodash-amd/modern/utilities/escape"],function(e){return function(){return function(t){t.registerPlainTextFormatter(e)}}}),define("plugins/core/inline-elements-mode",[],function(){function e(e){var t=document.createTreeWalker(e);while(t.nextNode())if(t.currentNode)if(~["br"].indexOf(t.currentNode.nodeName.toLowerCase())||t.currentNode.length>0)return!0;return!1}return function(){return function(t){t.el.addEventListener("keydown",function(n){if(n.keyCode===13){var r=new t.api.Selection,i=r.range,s=r.getContaining(function(e){return e.nodeName==="LI"||/^(H[1-6])$/.test(e.nodeName)});s||(n.preventDefault(),t.transactionManager.run(function(){t.el.lastChild.nodeName==="BR"&&t.el.removeChild(t.el.lastChild);var n=document.createElement("br");i.insertNode(n),i.collapse(!1);var s=i.cloneRange();s.setEndAfter(t.el.lastChild,0);var o=s.cloneContents();if(!e(o)){var u=document.createElement("br");i.insertNode(u)}var a=i.cloneRange();a.setStartAfter(n,0),a.setEndAfter(n,0),r.selection.removeAllRanges(),r.selection.addRange(a)}))}}.bind(this)),t.getHTML().trim()===""&&t.setContent("")}}}),define("plugins/core/patches/commands/bold",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("bold");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return e.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!n},e.commandPatches.bold=t}}}),define("plugins/core/patches/commands/indent",[],function(){var e="ï»¿";return function(){return function(t){var n=new t.api.CommandPatch("indent");n.execute=function(n){t.transactionManager.run(function(){var r=new t.api.Selection,i=r.range,s=i.commonAncestorContainer.nodeName==="P"&&i.commonAncestorContainer.innerHTML==="<br>";if(s){var o=document.createTextNode(e);i.insertNode(o),i.setStart(o,0),i.setEnd(o,0),r.selection.removeAllRanges(),r.selection.addRange(i)}t.api.CommandPatch.prototype.execute.call(this,n),r=new t.api.Selection;var u=r.getContaining(function(e){return e.nodeName==="BLOCKQUOTE"});u&&u.removeAttribute("style")}.bind(this))},t.commandPatches.indent=n}}}),define("plugins/core/patches/commands/insert-html",["scribe-common/src/element"],function(e){return function(){return function(t){var n=new t.api.CommandPatch("insertHTML");n.execute=function(n){t.transactionManager.run(function(){function r(t){var n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),i=n.firstChild();if(!i)return;do i.nodeName==="SPAN"?e.unwrap(t,i):(i.style.lineHeight=null,i.getAttribute("style")===""&&i.removeAttribute("style")),r(i);while(i=n.nextSibling())}t.api.CommandPatch.prototype.execute.call(this,n),r(t.el)}.bind(this))},t.commandPatches.insertHTML=n}}}),define("plugins/core/patches/commands/insert-list",["scribe-common/src/element","scribe-common/src/node"],function(e,t){return function(){return function(n){var r=function(e){n.api.CommandPatch.call(this,e)};r.prototype=Object.create(n.api.CommandPatch.prototype),r.prototype.constructor=r,r.prototype.execute=function(r){n.transactionManager.run(function(){n.api.CommandPatch.prototype.execute.call(this,r);if(this.queryState()){var i=new n.api.Selection,s=i.getContaining(function(e){return e.nodeName==="OL"||e.nodeName==="UL"});s.nextElementSibling&&s.nextElementSibling.childNodes.length===0&&t.removeNode(s.nextElementSibling);if(s){var o=s.parentNode;o&&/^(H[1-6]|P)$/.test(o.nodeName)&&(i.placeMarkers(),t.insertAfter(s,o),i.selectMarkers(),o.childNodes.length===2&&t.isEmptyTextNode(o.firstChild)&&t.removeNode(o),o.childNodes.length===0&&t.removeNode(o))}var u=Array.prototype.slice.call(s.childNodes);u.forEach(function(t){var n=Array.prototype.slice.call(t.childNodes);n.forEach(function(n){if(n.nodeName==="SPAN"){var r=n;e.unwrap(t,r)}else n.nodeType===Node.ELEMENT_NODE&&(n.style.lineHeight=null,n.getAttribute("style")===""&&n.removeAttribute("style"))})})}}.bind(this))},n.commandPatches.insertOrderedList=new r("insertOrderedList"),n.commandPatches.insertUnorderedList=new r("insertUnorderedList")}}}),define("plugins/core/patches/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("outdent");t.execute=function(){e.transactionManager.run(function(){var t=new e.api.Selection,n=t.range,r=t.getContaining(function(e){return e.nodeName==="BLOCKQUOTE"});if(n.commonAncestorContainer.nodeName==="BLOCKQUOTE"){t.placeMarkers(),t.selectMarkers(!0);var i=n.cloneContents();r.parentNode.insertBefore(i,r),n.deleteContents(),t.selectMarkers(),r.textContent===""&&r.parentNode.removeChild(r)}else{var s=t.getContaining(function(e){return e.nodeName==="P"});if(s){var o=(new e.api.Node(s)).nextAll();if(o.length){var u=document.createElement(r.nodeName);o.forEach(function(e){u.appendChild(e)}),r.parentNode.insertBefore(u,r.nextElementSibling)}t.placeMarkers(),r.parentNode.insertBefore(s,r.nextElementSibling),t.selectMarkers(),r.innerHTML===""&&r.parentNode.removeChild(r)}else e.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},e.commandPatches.outdent=t}}}),define("plugins/core/patches/commands/create-link",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("createLink");e.commandPatches.createLink=t,t.execute=function(t){var n=new e.api.Selection;if(n.selection.isCollapsed){var r=document.createElement("a");r.setAttribute("href",t),r.textContent=t,n.range.insertNode(r);var i=document.createRange();i.setStartBefore(r),i.setEndAfter(r),n.selection.removeAllRanges(),n.selection.addRange(i)}else e.api.CommandPatch.prototype.execute.call(this,t)}}}}),define("plugins/core/patches/events",["scribe-common/src/element"],function(e){return function(){return function(t){t.allowsBlockElements()&&t.el.addEventListener("keyup",function(n){if(n.keyCode===8||n.keyCode===46){var r=new t.api.Selection,i=r.getContaining(function(e){return e.nodeName==="P"});i&&(t.undoManager.undo(),t.transactionManager.run(function(){r.placeMarkers();var t=Array.prototype.slice.call(i.childNodes);t.forEach(function(t){if(t.nodeName==="SPAN"){var n=t;e.unwrap(i,n)}else t.nodeType===Node.ELEMENT_NODE&&(t.style.lineHeight=null,t.getAttribute("style")===""&&t.removeAttribute("style"))}),r.selectMarkers()}))}})}}}),define("plugins/core/patches",["./patches/commands/bold","./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/commands/create-link","./patches/events"],function(e,t,n,r,i,s,o){return{commands:{bold:e,indent:t,insertHTML:n,insertList:r,outdent:i,createLink:s},events:o}}),define("plugins/core/set-root-p-element",[],function(){return function(){return function(e){e.getHTML().trim()===""&&e.setContent("<p><br></p>")}}}),define("api/command-patch",[],function(){return function(e){function t(e){this.commandName=e}return t.prototype.execute=function(t){e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},t}}),define("api/command",[],function(){return function(e){function t(t){this.commandName=t,this.patch=e.commandPatches[this.commandName]}return t.prototype.execute=function(t){this.patch?this.patch.execute(t):e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},t}}),define("api/node",[],function(){function e(e){this.node=e}return e.prototype.getAncestor=function(e){var t=function(e){return e&&e.attributes&&e.attributes.getNamedItem("contenteditable")};if(t(this.node))return;var n=this.node.parentNode;while(n&&!t(n)){if(e(n))return n;n=n.parentNode}},e.prototype.nextAll=function(){var e=[],t=this.node.nextSibling;while(t)e.push(t),t=t.nextSibling;return e},e}),define("api/selection",[],function(){return function(e){function t(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return t.prototype.getContaining=function(t){var n=new e.api.Node(this.range.commonAncestorContainer),r=n.node&&n.node.attributes&&n.node.attributes.getNamedItem("contenteditable");return!r&&t(n.node)?n.node:n.getAncestor(t)},t.prototype.placeMarkers=function(){var e=document.createElement("em");e.classList.add("scribe-marker");var t=document.createElement("em");t.classList.add("scribe-marker");var n=this.range.cloneRange();n.collapse(!1),n.insertNode(t),t.nextSibling&&t.nextSibling.nodeType===Node.TEXT_NODE&&t.nextSibling.data===""&&t.parentNode.removeChild(t.nextSibling),t.previousSibling&&t.previousSibling.nodeType===Node.TEXT_NODE&&t.previousSibling.data===""&&t.parentNode.removeChild(t.previousSibling);if(!this.selection.isCollapsed){var r=this.range.cloneRange();r.collapse(!0),r.insertNode(e),e.nextSibling&&e.nextSibling.nodeType===Node.TEXT_NODE&&e.nextSibling.data===""&&e.parentNode.removeChild(e.nextSibling),e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE&&e.previousSibling.data===""&&e.parentNode.removeChild(e.previousSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)},t.prototype.getMarkers=function(){return e.el.querySelectorAll("em.scribe-marker")},t.prototype.removeMarkers=function(){var e=this.getMarkers();Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)})},t.prototype.selectMarkers=function(e){var t=this.getMarkers();if(!t.length)return;var n=document.createRange();n.setStartBefore(t[0]),t.length>=2?n.setEndAfter(t[1]):n.setEndAfter(t[0]),e||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(n)},t.prototype.isCaretOnNewLine=function(){var e=this.getContaining(function(e){return e.nodeName==="P"});if(e){var t=e.innerHTML.trim();return e.nodeName==="P"&&(t==="<br>"||t==="")}return!1},t}}),define("api/simple-command",[],function(){return function(e,t){function n(e,n){t.api.Command.call(this,e),this.nodeName=n}return n.prototype=Object.create(e.Command.prototype),n.prototype.constructor=n,n.prototype.queryState=function(){var e=new t.api.Selection;return t.api.Command.prototype.queryState.call(this)&&!!e.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))},n}}),define("api",["./api/command-patch","./api/command","./api/node","./api/selection","./api/simple-command"],function(e,t,n,r,i){return function(o){this.CommandPatch=e(o),this.Command=t(o),this.Node=n,this.Selection=r(o),this.SimpleCommand=i(this,o)}}),define("lodash-amd/modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,s){var o,u=r,a=u;if(!u)return a;var f=arguments,l=0,c=typeof s=="number"?2:f.length;if(c>3&&typeof f[c-2]=="function")var h=e(f[--c-1],f[c--],2);else c>2&&typeof f[c-1]=="function"&&(h=f[--c]);while(++l<c){u=f[l];if(u&&n[typeof u]){var p=-1,d=n[typeof u]&&t(u),v=d?d.length:0;while(++p<v)o=d[p],a[o]=h?h(a[o],u[o]):u[o]}}return a};return r}),define("transaction-manager",["lodash-amd/modern/objects/assign"],function(e){return function(t){function n(){this.history=[]}return e(n.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),this.history.length===0&&(t.pushHistory(),t.trigger("content-changed"))},run:function(e){this.start();try{e&&e()}finally{this.end()}}}),n}}),define("undo-manager",[],function(){return function(e){function t(){this.position=-1,this.stack=[],this.debug=e.isDebugModeEnabled()}return t.prototype.maxStackSize=100,t.prototype.push=function(e){this.debug&&console.log("UndoManager.push: %s",e),this.stack.length=++this.position,this.stack.push(e);while(this.stack.length>this.maxStackSize)this.stack.shift(),--this.position},t.prototype.undo=function(){if(this.position>0)return this.stack[--this.position]},t.prototype.redo=function(){if(this.position<this.stack.length-1)return this.stack[++this.position]},t}}),define("lodash-amd/modern/arrays/pull",[],function(){function n(e){var n=arguments,r=0,i=n.length,s=e?e.length:0;while(++r<i){var o=-1,u=n[r];while(++o<s)e[o]===u&&(t.call(e,o--,1),s--)}return e}var e=[],t=e.splice;return n}),define("event-emitter",["lodash-amd/modern/arrays/pull"],function(e){function t(){this._listeners={}}return t.prototype.on=function(e,t){var n=this._listeners[e]||[];n.push(t),this._listeners[e]=n},t.prototype.off=function(t,n){var r=this._listeners[t]||[];n?e(r,n):delete this._listeners[t]},t.prototype.trigger=function(e,t){var n=this._listeners[e]||[];n.forEach(function(e){e.apply(null,t)})},t}),define("scribe",["lodash-amd/modern/objects/defaults","lodash-amd/modern/arrays/flatten","./plugins/core/commands","./plugins/core/events","./plugins/core/formatters/html/replace-nbsp-chars","./plugins/core/formatters/html/enforce-p-elements","./plugins/core/formatters/html/ensure-selectable-containers","./plugins/core/formatters/plain-text/escape-html-characters","./plugins/core/inline-elements-mode","./plugins/core/patches","./plugins/core/set-root-p-element","./api","./transaction-manager","./undo-manager","./event-emitter"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function v(t,v){d.call(this),this.el=t,this.commands={},this.options=e(v||{},{allowBlockElements:!0,debug:!1}),this.commandPatches={},this._plainTextFormatterFactory=new m,this._htmlFormatterFactory=new g,this.api=new c(this);var y=h(this);this.transactionManager=new y;var b=p(this);this.undoManager=new b,this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1),this.allowsBlockElements()?(this.use(l()),this.use(s()),this.use(o())):this.use(a()),this.use(u()),this.use(i()),this.use(f.commands.bold()),this.use(f.commands.indent()),this.use(f.commands.insertHTML()),this.use(f.commands.insertList()),this.use(f.commands.outdent()),this.use(f.commands.createLink()),this.use(f.events()),this.use(n.indent()),this.use(n.insertList()),this.use(n.outdent()),this.use(n.redo()),this.use(n.subscript()),this.use(n.superscript()),this.use(n.undo()),this.use(r())}function m(){this.formatters=[]}function g(){this.formatters={sanitize:[],normalize:[],"export":[]}}return v.prototype=Object.create(d.prototype),v.prototype.use=function(e){return e(this),this},v.prototype.setHTML=function(e,t){t&&(this._skipFormatters=!0),this.el.innerHTML=e},v.prototype.getHTML=function(){return this.el.innerHTML},v.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},v.prototype.getTextContent=function(){return this.el.textContent},v.prototype.pushHistory=function(){var e=this.undoManager.stack[this.undoManager.position],t=e&&e.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!e||e&&this.getContent()!==t){var n=new this.api.Selection;n.placeMarkers();var r=this.getHTML();return n.removeMarkers(),this.undoManager.push(r),!0}return!1},v.prototype.getCommand=function(e){return this.commands[e]||this.commandPatches[e]||new this.api.Command(e)},v.prototype.restoreFromHistory=function(e){this.setHTML(e,!0);var t=new this.api.Selection;t.selectMarkers(),this.trigger("content-changed")},v.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},v.prototype.setContent=function(e){this.allowsBlockElements()||(e+="<br>"),this.setHTML(e),this.trigger("content-changed")},v.prototype.insertPlainText=function(e){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(e)+"</p>")},v.prototype.insertHTML=function(e){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(e))},v.prototype.isDebugModeEnabled=function(){return this.options.debug},v.prototype.registerHTMLFormatter=function(e,t){this._htmlFormatterFactory.formatters[e].push(t)},v.prototype.registerPlainTextFormatter=function(e){this._plainTextFormatterFactory.formatters.push(e)},m.prototype.format=function(e){var t=this.formatters.reduce(function(e,t){return t(e)},e);return t},g.prototype=Object.create(m.prototype),g.prototype.constructor=g,g.prototype.format=function(e){var n=t([this.formatters.sanitize,this.formatters.normalize]),r=n.reduce(function(e,t){return t(e)},e);return r},g.prototype.formatForExport=function(e){return this.formatters.export.reduce(function(e,t){return t(e)},e)},v}),define("scribe-plugin-toolbar",[],function(){return function(e){return function(t){var n=e.querySelectorAll("button[data-command-name]");Array.prototype.forEach.call(n,function(e){function n(){var n=t.getCommand(e.dataset.commandName),r=new t.api.Selection;r.range&&n.queryState()?e.classList.add("active"):e.classList.remove("active"),r.range&&n.queryEnabled()?e.removeAttribute("disabled"):e.setAttribute("disabled","disabled")}e.addEventListener("click",function(){var n=t.getCommand(e.dataset.commandName);t.el.focus(),n.execute()}),t.el.addEventListener("keyup",n),t.el.addEventListener("mouseup",n),t.el.addEventListener("focus",n),t.el.addEventListener("blur",n),t.on("content-changed",n)})}}}),define("scribe-plugins/linkPromptCommand",[],function(){return function(){return function(e){var t=new e.api.Command("createLink"),n=e.el.tagName.toLowerCase()==="a";t.nodeName="A",t.execute=function(){var t;if(n)t=e.el;else{var r=new e.api.Selection,i=r.range;t=r.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))}var s=t?t.href:"http://",o=window.prompt("Enter a link.",s);!n&&t&&(i.selectNode(t),r.selection.removeAllRanges(),r.selection.addRange(i)),o&&(/^https?\:\/\//.test(o)||(!/^mailto\:/.test(o)&&/@/.test(o)?o="mailto:"+o:o="http://"+o),n?t.href=o:e.api.SimpleCommand.prototype.execute.call(this,o))},t.queryState=function(){var t=new e.api.Selection;return!!t.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))},e.commands.linkPrompt=t}}}),define("Editor",["scribe","scribe-plugin-toolbar","./scribe-plugins/linkPromptCommand"],function(e,t,n){function r(e,t){this.dytomate=e,this.element=t,this.listeners={},this.body=null,this.overlay={},this.toolbar={},this.textarea=null,this.scribe=null,this.mode=r.MODE.WYSIWYG,this.enabled=!1}return r.MODE={WYSIWYG:"wysiwyg",HTML:"html"},r.prototype.enable=function(){return this.enabled||(this.body=document.querySelector("body"),this.initElement(),this.removeExtraWhitespace(),this.initOverlay(),this.initScribe(),this.attachListeners(),this.enabled=!0),this},r.prototype.disable=function(){return this.enabled&&(this.save(),this.detachListeners(),this.deinitOverlay(),this.deinitElement(),this.deinitScribe(),this.enabled=!1),this},r.prototype.initElement=function(){return this.element.style.outline="none",this.dytomate.setElementDytomateAttribute(this.element,"in-edit","true"),this},r.prototype.deinitElement=function(){return this.dytomate.removeElementDytomateAttribute(this.element,"in-edit"),this},r.prototype.initOverlay=function(){var e=this.element.getBoundingClientRect();this.overlay.window=document.createElement("div"),this.textarea=document.createElement("textarea"),this.toolbar.container=document.createElement("div"),["top","left","right","bottom"].forEach(function(e){this.overlay[e]=document.createElement("div"),this.overlay[e].style.position="fixed",this.overlay[e].style.zIndex=999,this.overlay[e].style.backgroundColor=this.dytomate.options.editorOverlayColor},this),["boldButton","italicButton","linkButton","htmlButton"].forEach(function(e,t){this.toolbar[e]=document.createElement("button"),this.toolbar[e].style.position="absolute",this.toolbar[e].style.top="0",this.toolbar[e].style.left=this.toPx((this.dytomate.options.editorToolbarButtonSize+this.dytomate.options.editorToolbarButtonSpacing)*t),this.toolbar[e].style.width=this.toPx(this.dytomate.options.editorToolbarButtonSize),this.toolbar[e].style.height=this.toPx(this.dytomate.options.editorToolbarButtonSize),this.toolbar[e].style.padding="0",this.toolbar[e].style.margin="0",this.toolbar[e].style.border=this.toPx(this.dytomate.options.editorToolbarButtonBorderWidth)+" solid "+this.dytomate.options.editorToolbarButtonBorderColor,this.toolbar[e].style.boxShadow="0 0 "+this.toPx(this.dytomate.options.editorToolbarButtonShadowSize)+" "+this.dytomate.options.editorToolbarButtonShadowColor,this.toolbar[e].style.cursor="pointer",this.toolbar[e].style.backgroundSize="contain",this.toolbar[e].style.backgroundColor=this.dytomate.options.editorToolbarButtonColor,this.toolbar[e].classList.add("dytomate-editor-command-button"),this.toolbar[e].addEventListener("mouseover",function(){this.toolbar[e].style.backgroundColor=this.dytomate.options.editorToolbarButtonHoverColor,this.toolbar[e].style.boxShadow="0 0 "+this.toPx(this.dytomate.options.editorToolbarButtonShadowHoverSize)+" "+this.dytomate.options.editorToolbarButtonShadowColor}.bind(this)),this.toolbar[e].addEventListener("mouseout",function(){this.toolbar[e].style.backgroundColor=this.dytomate.options.editorToolbarButtonColor,this.toolbar[e].style.boxShadow="0 0 "+this.toPx(this.dytomate.options.editorToolbarButtonShadowSize)+" "+this.dytomate.options.editorToolbarButtonShadowColor}.bind(this))},this),this.overlay.window.style.position="fixed",this.overlay.window.style.zIndex=999,this.overlay.window.style.boxSizing="content-box",this.overlay.window.style.padding=this.toPx(this.dytomate.options.editorPadding),this.overlay.window.style.border=this.toPx(this.dytomate.options.editorBorderWidth)+" solid "+this.dytomate.options.editorBorderColor,this.overlay.window.style.pointerEvents="none",this.overlay.window.style.boxShadow="0 0 "+this.toPx(this.dytomate.options.editorShadowSize)+" "+this.dytomate.options.editorShadowColor,this.textarea.style.position="fixed",this.textarea.style.zIndex=999,this.textarea.style.display="none",this.textarea.style.boxSizing="content-box",this.textarea.style.padding=this.toPx(this.dytomate.options.editorPadding),this.textarea.style.border=this.toPx(this.dytomate.options.editorBorderWidth)+" solid "+this.dytomate.options.editorBorderColor,this.textarea.style.resize="none",this.textarea.classList.add("dytomate-editor-textarea"),this.overlay.top.style.top="0",this.overlay.top.style.left="0",this.overlay.top.style.right="0",this.overlay.left.style.left="0",this.overlay.right.style.right="0",this.overlay.bottom.style.left="0",this.overlay.bottom.style.right="0",this.overlay.bottom.style.bottom="0",this.toolbar.container.style.position="fixed",this.toolbar.container.style.zIndex=999,this.toolbar.boldButton.setAttribute("data-command-name","bold"),this.toolbar.boldButton.style.backgroundImage="url(data:image/gif;base64,R0lGODlhQABAAKIHALa2tsXFxVJSUvf394WFhebm5gAAAP///yH5BAEAAAcALAAAAABAAEAAQAP/eLrc/jDK+YS5OJsAB7BaaBADZYLiBZjHgKbGylawaga1IZQz9IoCgnBIEBhzOgCv58vJZgOkYdn7hZ4sF1LJPFg1xrA4LI11aWVYEBDgnk9OUxRJeC++GaxEW9vZvTkcDwEENSR/aDB6EgBIfm94GIsUODkCBV2RNlmaF3WIoKGio4idaSIEmKOdkw2NW6CsLAVSqpBxLIWBf7I3SLa3Na0LfCmPsadSgqR3uBIFuoZUZ72cv8GKXa+GwCzVM9swh0zfJtHi2CnLEgGmU7zJZUZuzPX29/j5zO6n89OhnUgUGFiAED8zoso1GHAOHTJh5qT8I+dsQkMgE2cohEALk8m6TBUnmPqUTsSwhaY+UoRooqOhUiE7BHyYbcKcGt1KXmGnaRzAHAQCCBVaJJIAeqQO9mOTUaeGYR4uhjj6kyWFcMZyVonJiI6djey8UuNqcUvTCGDDAj3bxOqMSn20iiTbFahcCWk5ShzrlsJNnE7zzJAKhi3eXREGEJJyLHA8cXeZtBlKubLly0MBRNbHuTO+BAA7)",this.toolbar.italicButton.setAttribute("data-command-name","italic"),this.toolbar.italicButton.style.backgroundImage="url(data:image/gif;base64,R0lGODlhQABAAKIHAJ2dnSwsLGNjY/j4+OLi4sPDwwAAAP///yH5BAEAAAcALAAAAABAAEAAQAP/eLrc/jDKSasjJmsjrP9RsWUAaJ5DMHZn6wmjMbj0BMRErT/iWO7AA0AVMxSCyAbMEGg6n00mK3nqbY7UGsaXraVWs67rNsKKq7Hf2bTdTNfwuHw+CJOLnNyc0tYEwnsUXxt/gRZLG3qGE4gaiosRd46QE1YaapQPfSSZEQMxb50Mg36AogsDjUympwqSGY+tpJenAKp4tK26u7yBKVG4GgKYmZZXvQREib0HmwbEuqoBsa3OobqvBtSnsxzMB8bPzN2FveHQrbfbop8r3+rjyhnlvOFmu+SsrefvOMzO6GrFuKer27VW2dZ1yscsW8BO4byxIwDAVrBnABTCKcCxC6PHjxwB6PtGMk4CADs=)",this.toolbar.linkButton.setAttribute("data-command-name","linkPrompt"),this.toolbar.linkButton.style.backgroundImage="url(data:image/gif;base64,R0lGODlhQABAAKIHANXV1YKCgiQkJKenp/f398jIyAAAAP///yH5BAEAAAcALAAAAABAAEAAQAP/eLrc/jDKSSsMJusMrP8HthXUsBkdSIkauRTGAAHCFqj4UdTavdC2nApw8j0IBcKCwMsYhbOTLMK0KaHYA7GY7XoJAZfXy8qIDyaNIDWOlA3nCbDXXqQNa+0pI1DugnUzTQY+MHs+BCdxWXNOHlV0gRFbGlOQjpKZmpucmWVsnR5vAIYaoKENb4sKd3inmqoelE5XbbEWjYSSpZgKuVO+g0+cBR25NwQdf5GowYAYAcIHVauBxw53T5eEtWPXFtvD3org0s2zMQ7h3c0M6FztsrTx9PX29/gPIq/5qSd5/fzt4cOv3q1WKPDdYoCw4KaFDxqigiiBFxx2tshZWNYrfRBFCd8kLSRAcpK5QGBOgJoD7MfJTBJ1DDLjjFknE320DBLAU0nIeD9/truGRGYQAA4zoUP2xtGlanV+InwSU5JQO7qWvIy6VUI4TVepCMPoxWLLCes4oTt7pOumtRC+1oOrFRC+pQDKBCBr7928gA1m7QUcocBgwogTS0gAADs=)",this.toolbar.htmlButton.style.backgroundImage="url(data:image/gif;base64,R0lGODlhQABAAIABAAAAAP///yH5BAEAAAEALAAAAABAAEAAAALWjI+py+0Po5y02ouz3g8ADkZeSDLeWKbBiaok27obHMsZXdsVfuoYn/NBgD2hhFg0DpFBJYKZdC6gUemByrImsFUpN6v9gq3isbJsNqLTujVM7Wa74u82XV661+f6farv9/LxN5hXGNI1k3izeBGo8ciIZ0EDwsNxqVipGUlBBAkkmen4+YNkWrrDRLqq2uoJ5Ro7wQVLZTsr8nW0u9TbIaYbDDzc4OZwbLyGvGwS55ysQAfdvHUnff2kZ5191ae9bQCIMj5YLj6+Ur7O3n6oBR8vPy9TAAA7)",this.positionOverlay();for(var t in this.overlay)this.overlay.hasOwnProperty(t)&&this.body.appendChild(this.overlay[t]);for(var t in this.toolbar)this.toolbar.hasOwnProperty(t)&&t!=="container"&&this.toolbar.container.appendChild(this.toolbar[t]);return this.body.appendChild(this.textarea),this.body.appendChild(this.toolbar.container),this},r.prototype.deinitOverlay=function(){for(var e in this.overlay)this.overlay.hasOwnProperty(e)&&this.body.removeChild(this.overlay[e]);return this.body.removeChild(this.textarea),this.body.removeChild(this.toolbar.container),this.overlay={},this.toolbar={},this.textarea=null,this},r.prototype.positionOverlay=function(){var e=this.element.getBoundingClientRect(),t=window.innerHeight,n=this.element.offsetWidth,r=this.element.offsetHeight,i=this.dytomate.options.editorPadding,s=this.dytomate.options.editorBorderWidth,o=this.dytomate.options.editorToolbarOffsetX,u=this.dytomate.options.editorToolbarOffsetY,a=this.dytomate.options.editorToolbarButtonSize,f=u>0?0:Math.abs(u),l=e.top-i,c=e.left-i,h=n,p=r+f,d=l,v=l,m=c,g=r+f+i*2+s*2,y=l,b=e.left+n+i+s*2,w=g,E=e.top+r+f+i+s*2,S=E+u,x=c+o;return S+a>t&&(S=e.top-i-s-a-u-f,f>0&&(l-=f,d-=f,v-=f,y-=f,E-=f)),this.overlay.window.style.top=this.toPx(l),this.overlay.window.style.left=this.toPx(c),this.overlay.window.style.width=this.toPx(h),this.overlay.window.style.height=this.toPx(p),this.textarea.style.top=this.toPx(l),this.textarea.style.left=this.toPx(c),this.textarea.style.width=this.toPx(h),this.textarea.style.height=this.toPx(p),this.overlay.top.style.height=this.toPx(d),this.overlay.left.style.top=this.toPx(v),this.overlay.left.style.width=this.toPx(m),this.overlay.left.style.height=this.toPx(g),this.overlay.right.style.top=this.toPx(y),this.overlay.right.style.left=this.toPx(b),this.overlay.right.style.height=this.toPx(w),this.overlay.bottom.style.top=this.toPx(E),this.toolbar.container.style.top=this.toPx(S),this.toolbar.container.style.left=this.toPx(x),this},r.prototype.removeExtraWhitespace=function(){var e=this.element.innerHTML;e=e.replace(/\r?\n|\r|\t/g,""),this.element.innerHTML=e;var t=function(e){for(var t=0;t<e.childNodes.length;t++)e.childNodes[t].nodeType===3&&!/\S/.test(e.childNodes[t].nodeValue)&&e.removeChild(e.childNodes[t])};return t(this.element),this},r.prototype.initScribe=function(){var r=this.elementSupportsBlockElements(),i=t(this.toolbar.container);return this.element.addEventListener("paste",this.listeners.elementPaste=function(e){e.stopImmediatePropagation(),e.preventDefault();if(e.clipboardData)this.scribe.insertPlainText(e.clipboardData.getData("text/plain"));else{var t=document.createElement("div"),n=new this.scribe.api.Selection;n.placeMarkers(),document.body.appendChild(t),t.setAttribute("contenteditable",!0),t.focus(),setTimeout(function(){var e=t.textContent||t.innerText||"";t.parentNode.removeChild(t),n.selectMarkers(),this.element.focus(),this.scribe.insertPlainText(e)},1)}}.bind(this)),this.scribe=new e(this.element,{allowBlockElements:r}),this.scribe.insertPlainText=function(e){this.insertHTML(this._plainTextFormatterFactory.format(e))}.bind(this.scribe),this.scribe.use(i),this.scribe.use(n()),this.focus(),this},r.prototype.deinitScribe=function(){return this.element.removeEventListener("paste",this.listeners.elementPaste),delete this.listeners.elementPaste,this.scribe=null,this.element.removeAttribute("contenteditable"),this},r.prototype.focus=function(){var e=function(t){var n=document.createTreeWalker(t),r=n.currentNode;return n.firstChild()?n.currentNode.nodeName.toLowerCase()==="br"?r:e(n.currentNode):n.currentNode};this.element.focus();var t=new this.scribe.api.Selection,n=e(this.scribe.el.firstChild),r=t.range;return r&&(r.setStart(n,0),r.setEnd(n,0),t.selection.removeAllRanges(),t.selection.addRange(r)),this},r.prototype.save=function(e){var t={},n=this.scribe.getHTML();return this.getElementTagName()==="a"&&(t.href=this.element.href,t.title=n),this.updateRelatedElements(),this.dytomate.saveText(this.element,n,t,function(t){t&&(this.element.innerHTML=t.value,this.getElementTagName()==="a"&&(this.element.href=t.attributes.href,this.element.setAttribute("title",t.attributes.title))),e&&e(t)}.bind(this)),this},r.prototype.updateRelatedElements=function(){var e=this.dytomate.getElementDytomateAttribute(this.element),t=document.querySelectorAll("*[data-"+this.dytomate.options.dataAttribute+'="'+e+'"]');for(var n=0;n<t.length;n++)t[n]!==this.element&&(t[n].innerHTML=this.scribe.getHTML());return this},r.prototype.switchToHtmlMode=function(){return this.textarea.value=this.scribe.getHTML(),this.textarea.style.display="block",this.mode=r.MODE.HTML,this},r.prototype.switchToWysiwygMode=function(){return this.element.innerHTML=this.textarea.value,this.removeExtraWhitespace(),this.positionOverlay(),this.textarea.style.display="none",this.mode=r.MODE.WYSIWYG,this},r.prototype.attachListeners=function(){var e=function(){this.positionOverlay()}.bind(this);return this.scribe.on("content-changed",this.listeners.scribeContentChanged=function(){e()}),window.addEventListener("scroll",this.listeners.windowScroll=function(){e()}),window.addEventListener("resize",this.listeners.windowResize=function(){e()}),this.toolbar.htmlButton.addEventListener("click",this.listeners.htmlButtonClick=function(){this.mode===r.MODE.WYSIWYG?this.switchToHtmlMode():this.switchToWysiwygMode()}.bind(this)),this},r.prototype.detachListeners=function(){return this.scribe.off("content-changed",this.listeners.scribeContentChanged),delete this.listeners.scribeContentChanged,window.removeEventListener("scroll",this.listeners.windowScroll),delete this.listeners.windowScroll,window.removeEventListener("resize",this.listeners.windowResize),delete this.listeners.windowResize,this.toolbar.htmlButton.removeEventListener("click",this.listeners.htmlButtonClick),delete this.listeners.htmlButtonClick,this},r.prototype.getElementTagName=function(){return this.element.tagName.toLowerCase()},r.prototype.elementSupportsBlockElements=function(){var e=["article","aside","blockquote","dd","div","dl","fieldset","figcaption","figure","footer","form","header","hgroup","ol","section","ul"];return e.indexOf(this.getElementTagName())!==-1},r.prototype.toPx=function(e){return e.toString()+"px"},r}),define("ImageChanger",[],function(){function e(e,t){this.dytomate=e,this.element=t,this.body=null,this.input=null,this.listeners={},this.enabled=!1}return e.prototype.enable=function(){return this.enabled||(this.body=document.querySelector("body"),this.initFileInput(),this.openBrowseDialog(),this.enabled=!0),this},e.prototype.disable=function(){return this.enabled&&(this.deinitFileInput(),this.body=null,this.enabled=!1),this},e.prototype.openBrowseDialog=function(){var e=new Event("click");return this.input.dispatchEvent(e),this},e.prototype.preview=function(e){var t=function(t){e&&e.call(this,t)}.bind(this);if(this.input.files&&this.input.files[0]){var n=new FileReader;n.onload=function(e){var n=new Image;n.onload=function(){this.element.src=e.target.result,t(this.input.files[0])}.bind(this),n.onerror=function(){t()}.bind(this),n.src=e.target.result}.bind(this),n.readAsDataURL(this.input.files[0])}return this},e.prototype.save=function(e,t){return this.dytomate.saveFile(this.element,e,{},t),this},e.prototype.initFileInput=function(){return this.input=document.createElement("input"),this.input.type="file",this.input.style.display="none",this.attachFileInputListener(function(){this.preview(function(e){e?this.save(e,function(){this.disable()}.bind(this)):this.disable()})}),this.body.appendChild(this.input),this},e.prototype.deinitFileInput=function(){return this.detachFileInputListener(),this.body.removeChild(this.input),this.input=null,this},e.prototype.attachFileInputListener=function(e){return this.input.addEventListener("change",this.listeners.inputChange=function(){this.detachFileInputListener(),e.call(this)}.bind(this)),this},e.prototype.detachFileInputListener=function(){return this.listeners.inputChange&&(this.input.removeEventListener("change",this.listeners.inputChange),delete this.listeners.inputChange),this},e.prototype.requestImageUpload=function(){var e=document.createElement("input");e.type="file",e.addEventListener("change",this.listeners.fileInputChange=function(){console.log("CHANGED!!!")}.bind(this))},e}),define("Dytomate",["reqwest","Editor","ImageChanger"],function(e,t,n){function r(e,t){t=t||{},this.container=e,this.options=this.mergeOptions({dataAttribute:"dytomate",doubleClickDelay:250,saveUrl:"/api/dytomate/save",uploadUrl:"/api/dytomate/upload",editorPadding:8,editorBorderWidth:1,editorBorderColor:"#666",editorShadowSize:10,editorShadowColor:"#333",editorOverlayColor:"rgba(255, 255, 255, .75)",editorToolbarOffsetX:0,editorToolbarOffsetY:8,editorToolbarButtonSize:24,editorToolbarButtonSpacing:4,editorToolbarButtonColor:"#fff",editorToolbarButtonHoverColor:"#BDF7FF",editorToolbarButtonShadowSize:0,editorToolbarButtonShadowHoverSize:5,editorToolbarButtonShadowColor:"#004A54",editorToolbarButtonBorderWidth:1,editorToolbarButtonBorderColor:"#666"},t),this.saveQueue=[],this.listeners={},this.editor=null,this.currentlySaving=!1,this.enabled=!1,this.enable()}return r.prototype.enable=function(){return this.enabled||(this.attachListeners(),this.enabled=!0),this},r.prototype.disable=function(){return this.enabled&&(this.editor&&this.closeTextElementEdit(),this.detachListeners(),this.enabled=!1),this},r.prototype.edit=function(e){var t=new CustomEvent("dytomatePreEdit",{detail:"dytomate",bubbles:!0,cancelable:!0});return e.dispatchEvent(t),e.tagName.toLowerCase()==="img"?this.editImageElement(e):this.editTextElement(e)},r.prototype.editImageElement=function(e){var t=new n(this,e);return t.enable(),t},r.prototype.editTextElement=function(e){var n=!1;return this.editor=new t(this,e),this.editor.enable(),e.addEventListener("mousedown",this.listeners.elementMouseDown=function(e){n=!0}),window.addEventListener("mouseup",this.listeners.windowMouseUp=function(e){var t=e.target;if(n){n=!1;return}while(t&&this.container.contains(t)){if(t.classList.contains("dytomate-editor-command-button")||t.classList.contains("dytomate-editor-textarea")||this.getElementDytomateAttribute(t,"in-edit")==="true"){n=!1;return}t=t.parentNode}this.closeTextElementEdit()}.bind(this)),this.editor},r.prototype.closeTextElementEdit=function(){return this.editor&&(this.editor.scribe.el.removeEventListener("mousedown",this.listeners.elementMouseDown),delete this.listeners.elementMouseDown,window.removeEventListener("mouseup",this.listeners.windowMouseUp),delete this.listeners.windowMouseUp,this.editor.disable(),this.editor=null),this},r.prototype.save=function(t,n,r,i,s,o){if(!o&&this.saveQueue.length>0)this.saveQueue.push({key:t,value:n,attributes:r,isFile:i,onDone:s});else{var u=i?this.options.uploadUrl:this.options.saveUrl,a=function(e){this.currentlySaving=!1;if(this.saveQueue.length>0){var t=this.saveQueue.shift();this.save(t.key,t.value,t.attributes,t.isFile,t.onDone,!0)}s&&s(e)}.bind(this),f=function(e){a(e)},l=function(){alert("Couldn't save `"+t+"`."),a()};typeof t=="object"&&(t=this.getElementDytomateAttribute(t)),this.currentlySaving=!0,e({url:u,method:"post",data:{key:t,value:n,attributes:r},error:function(e){l()},success:function(e){try{e=JSON.parse(e)}catch(t){e=!1}typeof e=="object"&&e.success?f(e):l()}})}return this},r.prototype.saveText=function(e,t,n,r){return this.save(e,t,n,!1,r,!1)},r.prototype.saveFile=function(e,t,n,r){var i=new FileReader;return i.onload=function(i){var s=i.target.result.split(",")[1];this.save(e,{name:t.name,blob:s},n,!0,r,!1)}.bind(this),i.readAsDataURL(t),this},r.prototype.attachListeners=function(){this.listeners.elementClickListenerElements=[],this.listeners.elementClick=function(e){if(e.detail!=="dytomate"){var t=e.target,n=e.target;while(t&&this.container.contains(t)){if(this.getElementDytomateAttribute(t)!==null){this.getElementDytomateAttribute(t,"in-edit")!=="true"&&this.getElementDytomateAttribute(t,"ro")===null&&(e.preventDefault(),e.stopPropagation(),this.handleDoubleClick(t,n));break}t=t.parentNode}}}.bind(this);var e=document.querySelectorAll("[data-"+this.options.dataAttribute+"]");window.onbeforeunload=function(e){if(this.saveQueue.length>0||this.currentlySaving)return"Changes are still being saved. Are you sure you want to navigate away ( changes will be lost )?"}.bind(this);for(var t=0;t<e.length;t++)this.listeners.elementClickListenerElements.push(e[t]),e[t].addEventListener("click",this.listeners.elementClick);return this.container.addEventListener("click",this.listeners.elementClick),this},r.prototype.detachListeners=function(){delete window.onbeforeunload;for(var e=0;e<this.listeners.elementClickListenerElements.length;e++)this.listeners.elementClickListenerElements[e].removeEventListener("click",this.listeners.elementClick);return this.listeners.elementClickListenerElements=[],this.container.removeEventListener("click",this.listeners.elementClick),delete this.listeners.elementClick,this},r.prototype.handleDoubleClick=function(e,t){var n=this.getElementDytomateAttribute(e,"double-click-timer");return n=n?parseInt(n,10):!1,n?(clearTimeout(n),this.removeElementDytomateAttribute(e,"double-click-timer"),this.edit(e)):(n=setTimeout(function(){var n=new CustomEvent("click",{detail:"dytomate",bubbles:!0,cancelable:!0});this.removeElementDytomateAttribute(e,"double-click-timer"),t.dispatchEvent(n)}.bind(this),this.options.doubleClickDelay),this.setElementDytomateAttribute(e,"double-click-timer",n)),this},r.prototype.getElementDytomateAttributeName=function(e){return e?e="-"+e:e="","data-"+this.options.dataAttribute+e},r.prototype.getElementDytomateAttribute=function(e,t){return t=this.getElementDytomateAttributeName(t),e.getAttribute(t)},r.prototype.setElementDytomateAttribute=function(e,t,n){return t=this.getElementDytomateAttributeName(t),e.setAttribute(t,n),this},r.prototype.removeElementDytomateAttribute=function(e,t){return t=this.getElementDytomateAttributeName(t),e.removeAttribute(t),this},r.prototype.mergeOptions=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},r}),requirejs(["Dytomate"],function(e){function t(){var t=document.querySelector("html");if(!t.classList.contains("no-auto-dytomate")){var n=document.querySelector("body"),r=n.getAttribute("data-dytomate");try{r=JSON.parse(r),typeof r!="object"&&(r={})}catch(i){r={}}n.removeAttribute("data-dytomate"),window.dytomate=new e(n,r)}}window.Dytomate=e,["complete","loaded","interactive"].indexOf(document.readyState)!==-1?t():document.addEventListener("DOMContentLoaded",t)}),define("main",function(){})})();